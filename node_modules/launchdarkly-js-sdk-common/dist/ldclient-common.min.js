!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e["LDClient-Common"]={})}(this,function(e){"use strict";function n(e){function n(e,n){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=n}return n.prototype=new Error,n.prototype.name=e,n.prototype.constructor=n,n}var t=n("LaunchDarklyUnexpectedResponseError"),r=n("LaunchDarklyInvalidEnvironmentIdError"),o=n("LaunchDarklyInvalidUserError"),i=n("LaunchDarklyInvalidEventKeyError"),a=n("LaunchDarklyInvalidArgumentError"),u=n("LaunchDarklyFlagFetchError");function s(e){return!(e>=400&&e<500)||(400===e||408===e||429===e)}for(var c=Object.freeze({LDUnexpectedResponseError:t,LDInvalidEnvironmentIdError:r,LDInvalidUserError:o,LDInvalidEventKeyError:i,LDInvalidArgumentError:a,LDFlagFetchError:u,isHttpErrorRecoverable:s}),l=function(e){for(var n,t=e.length,r=t%3,o=[],i=0,a=t-r;i<a;i+=16383)o.push(p(e,i,i+16383>a?a:i+16383));1===r?(n=e[t-1],o.push(f[n>>2]+f[n<<4&63]+"==")):2===r&&(n=(e[t-2]<<8)+e[t-1],o.push(f[n>>10]+f[n>>4&63]+f[n<<2&63]+"="));return o.join("")},f=[],v=[],d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,m=d.length;g<m;++g)f[g]=d[g],v[d.charCodeAt(g)]=g;function p(e,n,t){for(var r,o,i=[],a=n;a<t;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(f[(o=r)>>18&63]+f[o>>12&63]+f[o>>6&63]+f[63&o]);return i.join("")}v["-".charCodeAt(0)]=62,v["_".charCodeAt(0)]=63;var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=Array.isArray,b=Object.keys,k=Object.prototype.hasOwnProperty,E=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==(void 0===n?"undefined":h(n))&&"object"==(void 0===t?"undefined":h(t))){var r,o,i,a=y(n),u=y(t);if(a&&u){if((o=n.length)!=t.length)return!1;for(r=o;0!=r--;)if(!e(n[r],t[r]))return!1;return!0}if(a!=u)return!1;var s=n instanceof Date,c=t instanceof Date;if(s!=c)return!1;if(s&&c)return n.getTime()==t.getTime();var l=n instanceof RegExp,f=t instanceof RegExp;if(l!=f)return!1;if(l&&f)return n.toString()==t.toString();var v=b(n);if((o=v.length)!==b(t).length)return!1;for(r=o;0!=r--;)if(!k.call(t,v[r]))return!1;for(r=o;0!=r--;)if(!e(n[i=v[r]],t[i]))return!1;return!0}return n!=n&&t!=t},S=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},w=["key","secondary","ip","country","email","firstName","lastName","avatar","name"];function D(e){var n=unescape(encodeURIComponent(e));return l(function(e){for(var n=[],t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}(n))}function P(e){return D(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function O(e){return JSON.parse(JSON.stringify(e))}function U(e,n){return E(e,n)}function j(e){setTimeout(e,0)}function I(e,n){var t=e.then(function(e){return n&&setTimeout(function(){n(null,e)},0),e},function(e){if(!n)return Promise.reject(e);setTimeout(function(){n(e,null)},0)});return n?void 0:t}function R(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]={value:e[t],version:0});return n}function N(e){var n={};for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t].value);return n}function F(e,n){for(var t=n.slice(0),r=[],o=e,i=void 0;t.length>0;){for(i=[];o>0;){var a=t.shift();if(!a)break;(o-=P(JSON.stringify(a)).length)<0&&i.length>0?t.unshift(a):i.push(a)}o=e,r.push(i)}return r}function T(e){var n=e.version||"2.13.0";return e.userAgent+"/"+n}function L(e){return{"X-LaunchDarkly-User-Agent":T(e)}}function C(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce(function(e,n){return S({},e,n)},{})}function A(e){if(!e)return e;var n=void 0;for(var t in w){var r=w[t],o=e[r];void 0!==o&&"string"!=typeof o&&((n=n||Object.assign({},e))[r]=String(o))}return n||e}var x=Object.freeze({btoa:D,base64URLEncode:P,clone:O,deepEquals:U,onNextTick:j,wrapPromiseCallback:I,transformValuesToVersionedValues:R,transformVersionedValuesToValues:N,chunkUserEventsForUrl:F,getLDUserAgentString:T,getLDHeaders:L,extend:C,sanitizeUser:A}),q=2e3;function J(e,n,t,r){var o=n+"/events/bulk/"+t,i=n+"/a/"+t+".gif",a={};function u(e){(new window.Image).src=e}function c(n,t){var a=r||u,c=JSON.stringify(n);return t?function n(t){var r=C({"Content-Type":"application/json","X-LaunchDarkly-Event-Schema":"3"},L(e));return e.httpRequest("POST",o,r,c).promise.then(function(e){if(e)return e.status>=400&&s(e.status)&&t?n(!1):function(e){var n={status:e.status},t=e.header("date");if(t){var r=Date.parse(t);r&&(n.serverTime=r)}return n}(e)}).catch(function(){return t?n(!1):Promise.reject()})}(!0).catch(function(){}):(a(i+"?d="+P(c)),Promise.resolve())}return a.sendEvents=function(t){if(!e.httpRequest)return Promise.resolve();var r=e.httpAllowsPost(),o=void 0;o=r?[t]:F(q-n.length,t);for(var i=[],a=0;a<o.length;a++)i.push(c(o[a],r));return Promise.all(i)},a}function V(e){var n={},t=e.allAttributesPrivate,r=e.privateAttributeNames||[],o={key:!0,custom:!0,anonymous:!0},i={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0};return n.filterUser=function(e){if(!e)return null;var n=e.privateAttributeNames||[],a=function(e,i){return Object.keys(e).reduce(function(a,u){var s=a;return i(u)&&(!function(e){return!o[e]&&(t||-1!==n.indexOf(e)||-1!==r.indexOf(e))}(u)?s[0][u]=e[u]:s[1][u]=!0),s},[{},{}])},u=a(e,function(e){return i[e]}),s=u[0],c=u[1];if(e.custom){var l=a(e.custom,function(){return!0});s.custom=l[0],c=C({},c,l[1])}var f=Object.keys(c);return f.length&&(f.sort(),s.privateAttrs=f),s},n}function z(e){return e&&e.message?e.message:"string"==typeof e||e instanceof String?e:JSON.stringify(e)}var _=function(){return"LaunchDarkly client initialized"},K=" Please see https://docs.launchdarkly.com/docs/js-sdk-reference#section-initializing-the-client for instructions on SDK initialization.",M=function(){return"Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/docs/js-sdk-reference#section-analytics-events"},$=function(e){return'Expected application/json content type but got "'+e+'"'},H=function(){return"localStorage is unavailable"},G=function(){return"localStorage is unavailable, so anonymous user ID cannot be cached"},X=function(e){return"network error"+(e?" ("+e+")":"")},B=function(e){return'Custom event "'+e+'" does not exist'},W=function(){return"Environment not found. Double check that you specified a valid environment/client-side ID."+K},Q=function(){return"No environment/client-side ID was specified."+K},Y=function(e){return"Error fetching flag settings: "+z(e)},Z=function(){return"No user specified."+K},ee=function(){return"Invalid user specified."+K},ne=function(){return"LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."+K},te=function(){return"LaunchDarkly bootstrap data is not available because the back end could not read the flags."},re=function(e,n){return'[LaunchDarkly] "'+e+'" is deprecated, please use "'+n+'"'},oe=function(e,n,t){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+n+" - "+(s(e)?t:"giving up permanently")},ie=function(){return"Cannot make HTTP requests in this environment."+K},ae=function(){return"identify() has no effect here; it must be called on the main client instance"},ue=function(){return"Closing stream connection"},se=function(e){return"Opening stream connection to "+e},ce=function(e){return"Error on stream connection: "+z(e)},le=function(e){return"polling for feature flags at "+e},fe=function(){return"received ping message from stream"},ve=function(){return"received streaming update for all flags"},de=function(e){return'received streaming update for flag "'+e+'"'},ge=function(e){return'received streaming update for flag "'+e+'" but ignored due to version check'},me=function(e){return'received streaming deletion for flag "'+e+'"'},pe=function(e){return'received streaming deletion for flag "'+e+'" but ignored due to version check'},he=function(e){return'enqueueing "'+e+'" event'},ye=function(e){return"sending "+e+" events"},be=Object.freeze({clientInitialized:_,clientNotReady:function(){return"LaunchDarkly client is not ready"},eventWithoutUser:M,invalidContentType:$,invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:H,localStorageUnavailableForUserId:G,networkError:X,unknownCustomEventKey:B,environmentNotFound:W,environmentNotSpecified:Q,errorFetchingFlags:Y,userNotSpecified:Z,invalidUser:ee,bootstrapOldFormat:ne,bootstrapInvalid:te,deprecated:re,httpErrorMessage:oe,httpUnavailable:ie,identifyDisabled:ae,streamClosing:ue,streamConnecting:se,streamError:ce,debugPolling:le,debugStreamPing:fe,debugStreamPut:ve,debugStreamPatch:de,debugStreamPatchIgnored:ge,debugStreamDelete:me,debugStreamDeleteIgnored:pe,debugEnqueueingEvent:he,debugPostingEvents:ye});function ke(e,n,r){var o,i,a,u,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,f={},v=l||J(e,n.eventsUrl,r),d=(i=0,a=0,u={},(o={}).summarizeEvent=function(e){if("feature"===e.kind){var n=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),t=u[n];t?t.count=t.count+1:u[n]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===i||e.creationDate<i)&&(i=e.creationDate),e.creationDate>a&&(a=e.creationDate)}},o.getSummary=function(){var e={},n=!0;for(var t in u){var r=u[t],o=e[r.key];o||(o={default:r.default,counters:[]},e[r.key]=o);var s={value:r.value,count:r.count};void 0!==r.variation&&null!==r.variation&&(s.variation=r.variation),r.version?s.version=r.version:s.unknown=!0,o.counters.push(s),n=!1}return n?null:{startDate:i,endDate:a,features:e}},o.clearSummary=function(){i=0,a=0,u={}},o),g=V(n),m=n.inlineUsersInEvents,p=n.samplingInterval,h=n.flushInterval,y=n.logger,b=[],k=0,E=!1,S=void 0;function w(){return 0===p||0===Math.floor(Math.random()*p)}return f.enqueue=function(e){if(!E){var n,t=!1,r=!1;if(d.summarizeEvent(e),"feature"===e.kind?w()&&(t=!!e.trackEvents,r=!!(n=e).debugEventsUntilDate&&n.debugEventsUntilDate>k&&n.debugEventsUntilDate>(new Date).getTime()):t=w(),t&&b.push(function(e){var n=C({},e);return m||"identify"===e.kind?n.user=g.filterUser(e.user):(n.userKey=e.user.key,delete n.user),"feature"===e.kind&&(delete n.trackEvents,delete n.debugEventsUntilDate),n}(e)),r){var o=C({},e,{kind:"debug"});delete o.trackEvents,delete o.debugEventsUntilDate,delete o.variation,b.push(o)}}},f.flush=function(){if(E)return Promise.resolve();var e=b,n=d.getSummary();return d.clearSummary(),n&&(n.kind="summary",e.push(n)),0===e.length?Promise.resolve():(b=[],y.debug(ye(e.length)),v.sendEvents(e).then(function(e){e&&(e.serverTime&&(k=e.serverTime),s(e.status)||(E=!0),e.status>=400&&j(function(){c.maybeReportError(new t(oe(e.status,"event posting","some events were dropped")))}))}))},f.start=function(){S=setTimeout(function e(){f.flush(),S=setTimeout(e,h)},h)},f.stop=function(){clearTimeout(S)},f}function Ee(e){var n={},t={};return n.on=function(e,n,r){t[e]=t[e]||[],t[e]=t[e].concat({handler:n,context:r})},n.off=function(e,n,r){if(t[e])for(var o=0;o<t[e].length;o++)t[e][o].handler===n&&t[e][o].context===r&&(t[e]=t[e].slice(0,o).concat(t[e].slice(o+1)))},n.emit=function(e){if(t[e])for(var n=0;n<t[e].length;n++)t[e][n].handler.apply(t[e][n].context,Array.prototype.slice.call(arguments,1))},n.getEvents=function(){return Object.keys(t)},n.getEventListenerCount=function(e){return t[e]?t[e].length:0},n.maybeReportError=function(n){n&&(t["error"]?this.emit("error",n):(e||console).error(n.message))},n}var Se="application/json";function we(e,n,t){var o=n.baseUrl,i=n.useReport,a=n.evaluationReasons,s=n.sendLDHeaders,c=n.logger,l={},f={};function v(n,t){if(!e.httpRequest)return new Promise(function(e,n){n(new u(ie()))});var o=t?"REPORT":"GET",i=s?L(e):{};t&&(i["Content-Type"]="application/json");var a=f[n];a||(a=function(e){var n=void 0,t=void 0,r=void 0,o=void 0,i={addPromise:function(i,a){n=i,t&&t(),t=a,i.then(function(t){n===i&&(r(t),e&&e())},function(t){n===i&&(o(t),e&&e())})}};return i.resultPromise=new Promise(function(e,n){r=e,o=n}),i}(function(){delete f[n]}),f[n]=a);var c=e.httpRequest(o,n,i,t),l=c.promise.then(function(e){if(200===e.status){if(e.header("content-type")&&0===e.header("content-type").lastIndexOf(Se))return JSON.parse(e.body);var n=$(e.header("content-type")||"");return Promise.reject(new u(n))}return Promise.reject(function(e){return 404===e.status?new r(W()):new u(Y(e.statusText||String(e.status)))}(e))},function(e){return Promise.reject(new u(X(e)))});return a.addPromise(l,function(){c.cancel&&c.cancel()}),a.resultPromise}return l.fetchJSON=function(e){return v(o+e,null)},l.fetchFlagSettings=function(e,n){var r=void 0,u=void 0,s="",l=void 0;return i?(u=[o,"/sdk/evalx/",t,"/user"].join(""),l=JSON.stringify(e)):(r=P(JSON.stringify(e)),u=[o,"/sdk/evalx/",t,"/users/",r].join("")),n&&(s="h="+n),a&&(s=s+(s?"&":"")+"withReasons=true"),u=u+(s?"?":"")+s,c.debug(le(u)),v(u,l)},l}for(var De,Pe=(function(e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var t=new Uint8Array(16);e.exports=function(){return n(t),t}}else{var r=new Array(16);e.exports=function(){for(var e,n=0;n<16;n++)0==(3&n)&&(e=4294967296*Math.random()),r[n]=e>>>((3&n)<<3)&255;return r}}}(De={exports:{}},De.exports),De.exports),Oe=[],Ue=0;Ue<256;++Ue)Oe[Ue]=(Ue+256).toString(16).substr(1);var je,Ie,Re=function(e,n){var t=n||0,r=Oe;return[r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],"-",r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]],r[e[t++]]].join("")},Ne=0,Fe=0;var Te=function(e,n,t){var r=n&&t||0,o=n||[],i=(e=e||{}).node||je,a=void 0!==e.clockseq?e.clockseq:Ie;if(null==i||null==a){var u=Pe();null==i&&(i=je=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==a&&(a=Ie=16383&(u[6]<<8|u[7]))}var s=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:Fe+1,l=s-Ne+(c-Fe)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||s>Ne)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ne=s,Fe=c,Ie=a;var f=(1e4*(268435455&(s+=122192928e5))+c)%4294967296;o[r++]=f>>>24&255,o[r++]=f>>>16&255,o[r++]=f>>>8&255,o[r++]=255&f;var v=s/4294967296*1e4&268435455;o[r++]=v>>>8&255,o[r++]=255&v,o[r++]=v>>>24&15|16,o[r++]=v>>>16&255,o[r++]=a>>>8|128,o[r++]=255&a;for(var d=0;d<6;++d)o[r+d]=i[d];return n||Re(o)},Le="ld:$anonUserId";function Ce(e,n){var t={};return t.validateUser=function(t){if(!t)return Promise.reject(new o(Z()));var r=O(t);return null!==r.key&&void 0!==r.key?(r.key=r.key.toString(),Promise.resolve(r)):r.anonymous?(e?e.get(Le).catch(function(){return null}):Promise.resolve(null)).then(function(t){if(t)return r.key=t,r;var o=Te();return r.key=o,function(t){return e?e.set(Le,t).catch(function(){n.warn(G())}):Promise.resolve()}(o).then(function(){return r})}):Promise.reject(new o(ee()))},t}function Ae(e){var n=0;e&&(n="none"===e?100:["debug","info","warn","error"].indexOf(e));var t={};function r(e,t,r){e>=n&&t(r)}return t.debug=function(e){return r(0,console.log,e)},t.info=function(e){return r(1,console.info,e)},t.warn=function(e){return r(2,console.warn,e)},t.error=function(e){return r(3,console.error,e)},t}var xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qe="ready",Je="initialized",Ve="failed",ze="change",_e="internal-change";e.initialize=function(e,n,t,o,s){var c=t&&t.logger?t.logger:s&&s.logger||Ae("warn"),l=Ee(c),f=function(e,n,t,r){var o=C({logger:r},{baseUrl:"https://app.launchdarkly.com",streamUrl:"https://clientstream.launchdarkly.com",eventsUrl:"https://events.launchdarkly.com",sendEvents:!0,sendLDHeaders:!0,inlineUsersInEvents:!1,allowFrequentDuplicateEvents:!1,sendEventsOnlyForVariation:!1,useReport:!1,evaluationReasons:!1,flushInterval:2e3,samplingInterval:0,streamReconnectDelay:1e3,allAttributesPrivate:!1,privateAttributeNames:[]},t),i={all_attributes_private:"allAttributesPrivate",private_attribute_names:"privateAttributeNames"};function u(e){j(function(){n&&n.maybeReportError(new a(e))})}var s=C({},e||{});return function(e){var n=e;Object.keys(i).forEach(function(e){if(void 0!==n[e]){var t=i[e];r.warn(re(e,t)),void 0===n[t]&&(n[t]=n[e]),delete n[e]}})}(s),s=function(e,n){var t=C({},e);return Object.keys(n).forEach(function(e){void 0!==t[e]&&null!==t[e]||(t[e]=n[e])}),t}(s,o),(isNaN(s.flushInterval)||s.flushInterval<2e3)&&(s.flushInterval=2e3,u("Invalid flush interval configured. Must be an integer >= 2000 (milliseconds).")),(isNaN(s.samplingInterval)||s.samplingInterval<0)&&(s.samplingInterval=0,u("Invalid sampling interval configured. Sampling interval must be an integer >= 0.")),s}(t,l,s,c),v=f.hash,d=f.sendEvents,g=e,m=function(e,n,t,r){var o=n.streamUrl,i=n.logger,a={},u=o+"/eval/"+t,s=n.useReport,c=n.evaluationReasons,l=n.streamReconnectDelay,f=null,v=null,d=null,g=null;function m(e){i.warn(ce(e)),y(),p(l)}function p(e){v||(e?v=setTimeout(h,e):h())}function h(){v=null;var n=void 0,a="",l={};if(e.eventSourceFactory){for(var p in null!=r&&(a="h="+r),s?e.eventSourceAllowsReport?(n=u,l.method="REPORT",l.headers={"Content-Type":"application/json"},l.body=JSON.stringify(d)):(n=o+"/ping/"+t,a=""):n=u+"/"+P(JSON.stringify(d)),c&&(a=a+(a?"&":"")+"withReasons=true"),n=n+(a?"?":"")+a,y(),i.info(se(n)),f=e.eventSourceFactory(n,l),g)g.hasOwnProperty(p)&&f.addEventListener(p,g[p]);f.onerror=m}}function y(){f&&(i.info(ue()),f.close(),f=null)}return a.connect=function(e,n){d=e,g=n,p()},a.disconnect=function(){clearTimeout(v),v=null,y()},a.isConnected=function(){return!!(f&&e.eventSourceIsActive&&e.eventSourceIsActive(f))},a}(o,f,g,v),p=f.eventProcessor||ke(o,f,g,l),h=we(o,f,g),y={},b={},k=void 0,E=void 0,S=f.streaming,w=void 0,F=!1,T=!1,L=!0,x=f.stateProvider,q=function(e,n){var t={},r=void 0;return t.setUser=function(e){(r=A(e))&&n&&n(O(r))},t.getUser=function(){return r?O(r):null},e&&t.setUser(e),t}(null,function(e){x||e&&z({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})}),J=Ce(o.localStorage,c),V=void 0;function z(e){g&&(x&&x.enqueueEvent&&x.enqueueEvent(e)||(e.user?(L=!1,!d||T||o.isDoNotTrack()||(c.debug(he(e.kind)),p.enqueue(e))):L&&(c.warn(M()),L=!1)))}function K(e,n,t){var r=q.getUser(),o=new Date,i=n?n.value:null;if(!f.allowFrequentDuplicateEvents){var a=JSON.stringify(i)+(r&&r.key?r.key:"")+e,u=y[a];if(u&&o-u<3e5)return;y[a]=o}var s={kind:"feature",key:e,user:r,value:i,variation:n?n.variationIndex:null,default:t,creationDate:o.getTime(),reason:n?n.reason:null},c=b[e];c&&(s.version=c.flagVersion?c.flagVersion:c.version,s.trackEvents=c.trackEvents,s.debugEventsUntilDate=c.debugEventsUntilDate),z(s)}function $(e,n,t){var r=void 0;if(b&&b.hasOwnProperty(e)&&b[e]&&!b[e].deleted){var o=b[e];r=G(o),null!==o.value&&void 0!==o.value||(r.value=n)}else r={value:n,variationIndex:null,reason:{kind:"ERROR",errorKind:"FLAG_NOT_FOUND"}};return t&&K(e,r,n),r}function G(e){return{value:e.value,variationIndex:void 0===e.variation?null:e.variation,reason:e.reason||null}}function X(){E=!0,q.getUser()&&m.connect(q.getUser(),{ping:function(){c.debug(fe()),h.fetchFlagSettings(q.getUser(),v).then(function(e){return Z(e||{})}).catch(function(e){l.maybeReportError(new u(Y(e)))})},put:function(e){var n=JSON.parse(e.data);c.debug(ve()),Z(n)},patch:function(e){var n=JSON.parse(e.data),t=b[n.key];if(!t||!t.version||!n.version||t.version<n.version){c.debug(de(n.key));var r={},o=C({},n);delete o.key,b[n.key]=o;var i=G(o);r[n.key]=t?{previous:t.value,current:i}:{current:i},ee(r)}else c.debug(ge(n.key))},delete:function(e){var n=JSON.parse(e.data);if(!b[n.key]||b[n.key].version<n.version){c.debug(me(n.key));var t={};b[n.key]&&!b[n.key].deleted&&(t[n.key]={previous:b[n.key].value}),b[n.key]={version:n.version,deleted:!0},ee(t)}else c.debug(pe(n.key))}})}function W(){E&&(m.disconnect(),E=!1)}function Z(e){var n={};if(!e)return Promise.resolve();for(var t in b)b.hasOwnProperty(t)&&b[t]&&(e[t]&&!U(e[t].value,b[t].value)?n[t]={previous:b[t].value,current:G(e[t])}:e[t]&&!e[t].deleted||(n[t]={previous:b[t].value}));for(var r in e)e.hasOwnProperty(r)&&e[r]&&(!b[r]||b[r].deleted)&&(n[r]={current:G(e[r])});return b=Object.assign({},e),ee(n).catch(function(){})}function ee(e){var n=Object.keys(e);if(n.length>0){var t={};n.forEach(function(n){var r=e[n].current,o=r?r.value:void 0,i=e[n].previous;l.emit(ze+":"+n,o,i),t[n]=r?{current:o,previous:i}:{previous:i}}),l.emit(ze,t),l.emit(_e,b),f.sendEventsOnlyForVariation||x||n.forEach(function(n){K(n,e[n].current)})}return k&&V?V.saveFlags(b).catch(function(){return null}):Promise.resolve()}function oe(){var e=S||w&&void 0===S;e&&!E?X():!e&&E&&W()}function ie(e){return e===ze||e.substr(0,ze.length+1)===ze+":"}o.localStorage&&(V=new function(e,n,t,r,o){var i={};function a(){var e="",o=r.getUser();return o&&(e=t||D(JSON.stringify(o))),"ld:"+n+":"+e}return i.loadFlags=function(){return e.get(a()).then(function(e){if(null==e)return null;try{var n=JSON.parse(e);if(n){var t=n.$schema;void 0===t||t<1?n=R(n):delete n.$schema}return n}catch(e){return i.clearFlags().then(function(){return Promise.reject(e)})}}).catch(function(e){return o.warn(H()),Promise.reject(e)})},i.saveFlags=function(n){var t=C({},n,{$schema:1});return e.set(a(),JSON.stringify(t)).catch(function(e){return o.warn(H()),Promise.reject(e)})},i.clearFlags=function(){return e.clear(a()).catch(function(e){return o.warn(H()),Promise.reject(e)})},i}(o.localStorage,g,v,q,c));var le=new Promise(function(e){var n=l.on(qe,function(){l.off(qe,n),e()})}),ye=new Promise(function(e,n){var t=l.on(Je,function(){l.off(Je,t),e()}),r=l.on(Ve,function(e){l.off(Ve,r),n(e)})});if("string"==typeof f.bootstrap&&"LOCALSTORAGE"===f.bootstrap.toUpperCase()&&(V?k=!0:c.warn(H())),"object"===xe(f.bootstrap)&&(b=function(e){var n=Object.keys(e),t=e.$flagsState;!t&&n.length&&c.warn(ne()),!1===e.$valid&&c.warn(te());var r={};return n.forEach(function(n){if("$flagsState"!==n&&"$valid"!==n){var o={value:e[n]};t&&t[n]?o=C(o,t[n]):o.version=0,r[n]=o}}),r}(f.bootstrap)),x){var be=x.getInitialState();be?Se(be):x.on("init",Se),x.on("update",function(e){e.user&&q.setUser(e.user),e.flags&&Z(e.flags)})}else(e?J.validateUser(n).then(function(e){return q.setUser(e),"object"===xe(f.bootstrap)?De():k?V.loadFlags().catch(function(){return null}).then(function(e){return null==e?(b={},h.fetchFlagSettings(q.getUser(),v).then(function(e){return Z(e||{})}).then(De).catch(function(e){var n=new u(Y(e));Pe(n)})):(b=e,j(De),h.fetchFlagSettings(q.getUser(),v).then(function(e){return Z(e)}).catch(function(e){return l.maybeReportError(e)}))}):h.fetchFlagSettings(q.getUser(),v).then(function(e){b=e||{},De()}).catch(function(e){b={},Pe(e)})}):Promise.reject(new r(Q()))).catch(function(e){return l.maybeReportError(e)});function Se(e){g=e.environment,q.setUser(e.user),b=Object.assign({},e.flags),j(De)}function De(){c.info(_()),F=!0,oe(),l.emit(qe),l.emit(Je)}function Pe(e){l.maybeReportError(e),l.emit(Ve,e),l.emit(qe)}return{client:{waitForInitialization:function(){return ye},waitUntilReady:function(){return le},identify:function(e,n,t){return T?I(Promise.resolve({}),t):x?(c.warn(ae()),I(Promise.resolve(N(b)),t)):I((k&&V?V.clearFlags():Promise.resolve()).then(function(){return J.validateUser(e)}).then(function(e){return q.setUser(e)}).then(function(){return h.fetchFlagSettings(q.getUser(),n)}).then(function(e){var n=N(e);return e?Z(e).then(function(){return n}):n}).then(function(e){return E&&X(),e}).catch(function(e){return l.maybeReportError(e),Promise.reject(e)}),t)},getUser:function(){return q.getUser()},variation:function(e,n){return $(e,n,!0).value},variationDetail:function(e,n){return $(e,n,!0)},track:function(e,n){"string"==typeof e?(o.customEventFilter&&!o.customEventFilter(e)&&c.warn(B(e)),z({kind:"custom",key:e,data:n,user:q.getUser(),url:o.getCurrentUrl(),creationDate:(new Date).getTime()})):l.maybeReportError(new i(B(e)))},on:function(e,n,t){ie(e)?(w=!0,F&&oe(),l.on(e,n,t)):l.on.apply(l,arguments)},off:function(e){if(l.off.apply(l,arguments),ie(e)){var n=!1;l.getEvents().forEach(function(e){ie(e)&&l.getEventListenerCount(e)>0&&(n=!0)}),n||(w=!1,E&&void 0===S&&W())}},setStreaming:function(e){var n=null===e?void 0:e;n!==S&&(S=n,oe())},flush:function(e){return I(d?p.flush():Promise.resolve(),e)},allFlags:function(){var e={};if(!b)return e;for(var n in b)b.hasOwnProperty(n)&&(e[n]=$(n,null,!f.sendEventsOnlyForVariation).value);return e},close:function(e){if(T)return I(Promise.resolve(),e);var n=function(){T=!0,b={}};return I(Promise.resolve().then(function(){if(W(),d)return p.stop(),p.flush()}).then(n).catch(n),e)}},options:f,emitter:l,ident:q,logger:c,requestor:h,start:function(){d&&p.start()},enqueueEvent:z,getFlagsInternal:function(){return b},getEnvironmentId:function(){return g},internalChangeEventName:_e}},e.version="2.13.0",e.createConsoleLogger=Ae,e.errors=c,e.messages=be,e.utils=x,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ldclient-common.min.js.map
